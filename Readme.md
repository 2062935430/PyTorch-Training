ğŸ¤³PyTorchè®­ç»ƒå·¥ç¨‹çš„å†…å®¹ğŸ¤³
----------------------------------------------------------------------------------------------------------------------------
----------------------------------------------------------------------------------------------------------------------------
1ï¸âƒ£æ¨¡å‹å®šä¹‰  
----------------------------------------------------------------------------------------------------------------------------

  é¦–å…ˆå¿…é¡»ç»§æ‰¿nn.Moduleè¿™ä¸ªç±»ï¼Œè¦è®©PyTorchçŸ¥é“è¿™ä¸ªç±»æ˜¯ä¸€ä¸ªModuleã€‚  

  ç„¶ååœ¨init(self)ä¸­è®¾ç½®å¥½éœ€è¦çš„"ç»„ä»¶"(å¦‚conv,pooling,Linear,BatchNormç­‰)ï¼Œç¬¬ä¸€è¡Œç”¨super(Net,self).__init__()å®ç°çˆ¶ç±»çš„åˆå§‹åŒ–ã€‚  

  æœ€åï¼Œåœ¨forward(self,x)ä¸­å®šä¹‰å¥½çš„â€œç»„ä»¶â€è¿›è¡Œç»„è£…ï¼Œå°±åƒæ­ç§¯æœ¨ï¼ŒæŠŠç½‘ç»œç»“æ„æ­å»ºå‡ºæ¥ï¼Œè¿™æ ·ä¸€ä¸ªæ¨¡å‹å°±å®šä¹‰å¥½äº† ã€‚ 

  ä»¥ä¸‹ä¸ºä¸€ä¸ªç®€å•çš„æ¨¡å‹ç¤ºä¾‹ï¼ˆæºäºçŸ¥ä¹ï¼‰ï¼š  

    import torch
    import torch.nn as nn
    import torch.functional as F
    class Net(nn.Module):
        def __init__(self):
            super(Net,self).__init__()#å®ç°çˆ¶ç±»çš„åˆå§‹åŒ–
            self.conv1=nn.Conv2d(3,6,5)#å®šä¹‰å·ç§¯å±‚ç»„ä»¶
            self.pool1=nn.MaxPool2d(2,2)#å®šä¹‰æ± åŒ–å±‚ç»„ä»¶
            self.conv2=nn.Conv2dn(6,16,5)
            self.pool2=nn.MaxPool2d(2,2)
            self.fc1=nn.Linear(16*5*5,120)#å®šä¹‰çº¿æ€§è¿æ¥
            self.fc2=nn.Linear(120,84)
            self.fc3=nn.Linear(84,10)
        def forward(self,x):#xæ¨¡å‹çš„è¾“å…¥
            x=self.pool1(F.relu(self.conv1(x)))
            x=self.pool2(F.relu(self.conv2(x)))
            x=x.view(-1,16*5*5)#è¡¨ç¤ºå°†xè¿›è¡Œreshapeï¼Œä¸ºåé¢åšä¸ºå…¨è¿æ¥å±‚çš„è¾“å…¥
            x=F.relu(self.fc1(x))
            x=F.relu(self.fc2(x))
            x=self.fc3(x)
        return x
            
   >æ¨¡å‹å®šä¹‰è¿˜æœ‰å…¶ä»–çš„å¸¸ç”¨æ–¹æ³•ç±»ä¼¼äºï¼šnn.Sequetialã€nn.Sequetialã€torch.nnã€‚
 
----------------------------------------------------------------------------------------------------------------------------
2ï¸âƒ£æ•°æ®å¤„ç†å’ŒåŠ è½½
----------------------------------------------------------------------------------------------------------------------------
 
  æˆ‘ä»¬å¯ä»¥ä½¿ç”¨torch.utils.data.Datasetç±»æ¥å®šä¹‰è‡ªå·±çš„æ•°æ®é›†ï¼Œå¹¶å®ç°__getitem__å’Œ__len__æ–¹æ³•ï¼Œä»¥æ”¯æŒæ•°æ®çš„ç´¢å¼•å’Œå¤§å°æŸ¥è¯¢ï¼›  
  
  Datasetç±»æ˜¯Pytorchä¸­å›¾åƒæ•°æ®é›†ä¸­æœ€ä¸ºé‡è¦çš„ä¸€ä¸ªç±»ï¼Œä¹Ÿæ˜¯Pytorchä¸­æ‰€æœ‰æ•°æ®é›†åŠ è½½ç±»ä¸­åº”è¯¥ç»§æ‰¿çš„çˆ¶ç±»ã€‚å…¶ä¸­çˆ¶ç±»ä¸­çš„ä¸¤ä¸ªç§æœ‰æˆå‘˜å‡½æ•°å¿…é¡»è¢«é‡è½½ï¼Œå¦åˆ™å°†ä¼šè§¦å‘é”™è¯¯æç¤ºï¼š  

    def getitem(self, index):
    def len(self):
  
  ***å…¶ä¸­__len__åº”è¯¥è¿”å›æ•°æ®é›†çš„å¤§å°ï¼Œè€Œ__getitem__åº”è¯¥ç¼–å†™æ”¯æŒæ•°æ®é›†ç´¢å¼•çš„å‡½æ•°ï¼Œä¾‹å¦‚é€šè¿‡dataset[i]å¯ä»¥å¾—åˆ°æ•°æ®é›†ä¸­çš„ç¬¬i+1ä¸ªæ•°æ®ã€‚***  
  
  Datasetç±»æ˜¯è¯»å…¥æ•°æ®é›†æ•°æ®å¹¶ä¸”å¯¹è¯»å…¥çš„æ•°æ®è¿›è¡Œäº†ç´¢å¼•ï¼Œä½†æ˜¯å…‰æœ‰è¿™ä¸ªåŠŸèƒ½æ˜¯ä¸å¤Ÿç”¨çš„ï¼› 

  ä¹Ÿå¯ä»¥ä½¿ç”¨torch.utils.data.DataLoaderç±»æ¥åˆ†æ‰¹æ¬¡ã€éšæœºã€å¹¶è¡Œåœ°åŠ è½½æ•°æ®ï¼›  

  åœ¨å®é™…çš„åŠ è½½æ•°æ®é›†çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬çš„æ•°æ®é‡å¾€å¾€éƒ½å¾ˆå¤§ï¼Œå¯¹æ­¤æˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸‹å‡ ä¸ªåŠŸèƒ½ï¼š  

    å¯ä»¥åˆ†æ‰¹æ¬¡è¯»å–ï¼šbatch-size  
    å¯ä»¥å¯¹æ•°æ®è¿›è¡Œéšæœºè¯»å–ï¼Œå¯ä»¥å¯¹æ•°æ®è¿›è¡Œæ´—ç‰Œæ“ä½œ(shuffling)ï¼Œæ‰“ä¹±æ•°æ®é›†å†…æ•°æ®åˆ†å¸ƒçš„é¡ºåº  
    å¯ä»¥å¹¶è¡ŒåŠ è½½æ•°æ®(åˆ©ç”¨å¤šæ ¸å¤„ç†å™¨åŠ å¿«è½½å…¥æ•°æ®çš„æ•ˆç‡)  
    
  å¦‚æœæ•°æ®æ˜¯å›¾ç‰‡ï¼Œè¿˜å¯ä»¥ä½¿ç”¨torchvision.datasets.ImageFolderç±»æ¥æ–¹ä¾¿åœ°è¯»å–å›¾ç‰‡å’Œæ ‡ç­¾:  
  
    imageFolderç±»:  
    
    ImageFolder(root, transform=None, target_transform=None, loader=default_loader)
    - rootï¼šåœ¨rootæŒ‡å®šçš„è·¯å¾„ä¸‹å¯»æ‰¾å›¾ç‰‡
    - transformï¼šå¯¹PIL Imageè¿›è¡Œçš„è½¬æ¢æ“ä½œï¼Œtransformçš„è¾“å…¥æ˜¯ä½¿ç”¨loaderè¯»å–å›¾ç‰‡çš„è¿”å›å¯¹è±¡
    - target_transformï¼šå¯¹labelçš„è½¬æ¢
    - loaderï¼šç»™å®šè·¯å¾„åå¦‚ä½•è¯»å–å›¾ç‰‡ï¼Œé»˜è®¤è¯»å–ä¸ºRGBæ ¼å¼çš„PIL Imageå¯¹è±¡
  
---
3ï¸âƒ£è®­ç»ƒæ¨¡å‹
---
  
  ä½ éœ€è¦å®šä¹‰æŸå¤±å‡½æ•°å’Œä¼˜åŒ–å™¨ï¼Œå¦‚torch.nn.MSELosså’Œtorch.optim.SGD1ã€‚  
  
    criterion = torch.nn.MSELoss(reduction='sum') 
    optimizer = torch.optim.SGD(model.parameters(), lr=1e-4)
    
  ç„¶åï¼Œä½ éœ€è¦åœ¨ä¸€ä¸ªå¾ªç¯ä¸­è¿›è¡Œå‰å‘ä¼ æ’­ã€è®¡ç®—æŸå¤±ã€åå‘ä¼ æ’­å’Œæ›´æ–°å‚æ•°çš„æ“ä½œã€‚  
  
    //å‰å‘ä¼ æ’­ï¼Œåå‘ä¼ æ’­
    
    for t in range(epoch):
        for step, (x, y) in enumerate(train_loader):
            # Forward pass: Compute predicted y by passing x to the model
            y_pred = model(x)
 
            # Compute and print loss
            loss = criterion(y_pred, y) # è®¡ç®—æŸå¤±å‡½æ•°
  
            # Zero gradients, perform a backward pass, and update the weights.
            optimizer.zero_grad() # æ¢¯åº¦ç½®é›¶ï¼Œå› ä¸ºåå‘ä¼ æ’­è¿‡ç¨‹ä¸­æ¢¯åº¦ä¼šç´¯åŠ ä¸Šä¸€æ¬¡å¾ªç¯çš„æ¢¯åº¦
            loss.backward() # lossåå‘ä¼ æ’­
            optimizer.step() # åå‘ä¼ æ’­åå‚æ•°æ›´æ–° 
   
 4ï¸âƒ£æ›´æ–°å‚æ•°
 ---
   
 åœ¨è®­ç»ƒæ¨¡å‹çš„è¿‡ç¨‹ä¸­ã€‚  
 
 æˆ‘ä»¬å¯ä»¥ä½¿ç”¨torch.optimæ¨¡å—ä¸­çš„ä¼˜åŒ–å™¨ï¼Œå¦‚torch.optim.SGDï¼Œ  
 
 æ¥å®ç°***æ¢¯åº¦ä¸‹é™ç®—æ³•***ï¼Œå¹¶åœ¨æ¯ä¸ªè®­ç»ƒå¾ªç¯ä¸­è°ƒç”¨optimizer.step()æ–¹æ³•æ¥æ›´æ–°å‚æ•°ã€‚  

 >æ¢¯åº¦ä¸‹é™çš„åŸºæœ¬æ€æƒ³ï¼šæœ€ä¼˜åŒ–ç®—æ³•ï¼Œç”¨äºæ±‚è§£æŸå¤±å‡½æ•°ï¼ˆloss functionï¼Œå³é¢„æµ‹å€¼f(x)äºçœŸå®å€¼Yå·®å¼‚ç¨‹åº¦çš„è¿ç®—å‡½æ•°ï¼‰çš„æœ€å°å€¼ã€‚  
 >
 >å…¶æ€æƒ³ä¸ºåœ¨å½“å‰ä½ç½®æ±‚åå¯¼ï¼Œå³æ¢¯åº¦ï¼Œæ­£å¸¸æ¢¯åº¦çš„æ–¹å‘ç±»ä¼¼äºä¸Šå±±æ–¹å‘ï¼Œ  
 >
 >æ˜¯ä½¿å€¼å‡½æ•°å¢å¤§çš„ï¼Œä¸‹å±±æœ€å¿«åˆ™éœ€ä½¿å…¶æœ€å°ï¼Œä»è´Ÿæ¢¯åº¦æ±‚æœ€å°å€¼ï¼Œæ­¤ä¸ºæ¢¯åº¦ä¸‹é™ã€‚  
 
 1ã€é¢„æµ‹å‡½æ•°  
 
 æœºå™¨å­¦ä¹ é€šè¿‡å­¦ä¹ ç®—æ³•ï¼Œè‡ªåŠ¨å‘ç°æ•°æ®èƒŒåçš„è§„å¾‹ï¼Œä¸æ–­æ”¹è¿›æ¨¡å‹ï¼Œç„¶ååšå‡ºé¢„æµ‹ã€‚
 
 ![å‡½æ•°](https://user-images.githubusercontent.com/128795948/235164403-16b56755-61bc-4663-bc64-f75baf8abef9.jpg)
 
 å…¶ä¸­å‡½æ•°y=wxä¸ºé¢„æµ‹å‡½æ•°ï¼Œwå³ä¸ºè¯¥å‡½æ•°å›¾åƒçš„æ–œç‡ï¼Œæ ·æœ¬ç‚¹å‚ç›´åˆ°ç›´çº¿çš„åç¦»ç¨‹åº¦ä¸ºæŸå¤±å‡½æ•°ï¼Œæ ·æœ¬ç‚¹å’Œå‡½æ•°å‚ç›´xè½´çš„åç¦»ç¨‹åº¦ä¸ºåå·®ã€‚

2ã€ä»£ä»·å‡½æ•°

-é‡åŒ–æ•°æ®åç¦»ç¨‹åº¦ï¼ˆè¯¯å·®ï¼‰ï¼Œå¸¸è§æ–¹æ³•ä¸º**å‡æ–¹è¯¯å·®**ã€‚  

-é€šè¿‡å®šä¹‰é¢„æµ‹å‡½æ•°ï¼Œåæ ¹æ®è¯¯å·®å…¬å¼æ¨å¯¼ä»£ä»·å‡½æ•°ï¼Œå°†æ ·æœ¬ç‚¹æ‹Ÿåˆè¿‡ç¨‹æ˜ å°„åˆ°ä¸€ä¸ªå‡½æ•°å›¾åƒä¸Šã€‚  

![å‡½æ•°](https://user-images.githubusercontent.com/128795948/235165253-6aecd002-61e0-41e6-8a41-9d2053acf902.jpg)

3ã€æ¢¯åº¦è®¡ç®—

æœºå™¨å­¦ä¹ çš„ç›®æ ‡ä¸ºæ‹Ÿåˆå‡ºæœ€æ¥è¿‘è®­ç»ƒæ•°æ®åˆ†å¸ƒçš„ç›´çº¿ï¼Œ  

å³æ‰¾åˆ°è¯¯å·®ä»£ä»·æœ€å°çš„å‚æ•°wï¼Œå¯¹åº”å‡½æ•°æœ€ä½ç‚¹ä½ç½®ï¼Œå…¶è¿‡ç¨‹ä¸ºæ¢¯åº¦ä¸‹é™ã€‚

![å‡½æ•°1](https://user-images.githubusercontent.com/128795948/235170383-25d992fd-d951-48b9-bada-b1560a41d1a1.png)
![å‡½æ•°1](https://user-images.githubusercontent.com/128795948/235171914-1395d89b-e920-464c-9572-116fdf53b8e1.png)

4ã€å­¦ä¹ ç‡

ç®—æ³•æ”¶æ•›æ—¶ï¼Œä»¤æ–œç‡ä¹˜ä¸€ä¸ªéå¸¸å°çš„å€¼ï¼Œä½¿æ¢¯åº¦ä¸‹é™ä¼˜åŒ–ï¼Œè¯¥å€¼ä¸ºå­¦ä¹ ç‡ã€‚  

é€šè¿‡å­¦ä¹ ç‡è°ƒæ•´æƒé‡çš„æ–¹å¼å°±æ˜¯***æ–°w=æ—§w-æ–œç‡Ã—å­¦ä¹ ç‡***ã€‚  

5ã€å¾ªç¯è¿­ä»£

å®é™…ä¸­ï¼Œä»£ä»·å‡½æ•°å› æ ·æœ¬å¤šæ ·è€Œåƒå˜ä¸‡åŒ–ï¼Œä¸ä¸€å®šä»…ä¸ºä¸€æ¡æŠ›ç‰©çº¿ï¼Œå¦‚é¢„æµ‹å‡½æ•°ä¸ºy=wx+bï¼Œä»£ä»·å‡½æ•°å˜ä¸ºè¯¯å·®eå…³äºå‚æ•°wå’Œbçš„æ›²é¢ï¼›

åŒæ—¶è¿˜å¯èƒ½å‡ºç°å¤šä¸ªæœ€å°ç‚¹å­˜åœ¨æ—¶ï¼Œæœºå™¨å­¦ä¹ ç›®æ ‡å°†æ˜¯æ‰¾åˆ°æœ€ä½ç‚¹é‚£ä¸ªç‚¹ï¼Œå³å…¨å±€æœ€ä¼˜ï¼Œè€Œéå±€éƒ¨æœ€ä¼˜ã€‚  

![image](https://user-images.githubusercontent.com/128795948/235173754-46b96fda-61a2-4e54-b471-f13e7da61b0b.png)

ä»£ä»·å‡½æ•°ç”šè‡³å¯ä»¥å› å…ƒç´ å¤šæ ·å˜ä¸ºæ›´å¤æ‚æ›´å¤šç»´çš„å›¾åƒè€Œä½¿å¯è§†åŒ–å›°éš¾ï¼Œä½†ç»´åº¦å¤šå°‘ä¸å½±å“æ¢¯åº¦ä¸‹é™æ³•çš„ä½¿ç”¨æ¥å¯»æ‰¾æœ€å°è¯¯å·®ç‚¹ã€‚  

>æ‰¹é‡æ¢¯åº¦ä¸‹é™æ³•ï¼ˆBGDï¼‰ï¼šå…¨éƒ¨è®­ç»ƒæ ·æœ¬å‚ä¸è®¡ç®—ï¼Œæ˜¯æ¢¯åº¦ä¸‹é™æœ€åŸå§‹çš„å½¢å¼ã€‚ä¼˜ç‚¹åœ¨èƒ½ä¿è¯ç®—æ³•ç²¾å‡†åº¦ï¼Œæ‰¾åˆ°å…¨å±€æœ€ä¼˜è§£ï¼Œä½†è®­ç»ƒæœç´¢è¿‡ç¨‹å˜æ…¢ã€‚  
>
>éšæœºæ¢¯åº¦ä¸‹é™æ³•ï¼ˆSGDï¼‰ï¼šæ¯ä¸‹é™ä¸€æ­¥ä»…éœ€ä¸€ä¸ªæ ·æœ¬è¿›è¡Œè®¡ç®—ï¼Œä¼˜ç‚¹åœ¨æå‡äº†è®¡ç®—çš„é€Ÿåº¦ï¼Œä½†ç‰ºç‰²äº†ä¸€å®šçš„ç²¾å‡†åº¦ã€‚  
>
>å°æ‰¹é‡æ¢¯åº¦ä¸‹é™æ³•ï¼ˆMBGDï¼‰ï¼šæ¯ä¸‹é™ä¸€æ­¥é€‰ç”¨ä¸€å°æ‰¹æ ·æœ¬å‚ä¸è®¡ç®—ï¼Œä¼˜ç‚¹åœ¨ç®€æ´ã€é«˜æ•ˆï¼Œå±äºå‰äºŒè€…çš„å±…ä¸­ç±»å‹ã€‚  

**æ¢¯åº¦ä¸‹é™æ³•ç®€å•æœ‰æ•ˆï¼Œé€‚ç”¨èŒƒå›´å¹¿ï¼Œä½†è‹¥å­¦ä¹ ç‡å–å€¼å¤ªå¤§ï¼Œå¯èƒ½åå¤æ¨ªè·³å–ä¸åˆ°æœ€ä½ç‚¹ï¼Œå¤ªå°åˆæµªè´¹è®¡ç®—é‡ï¼›**    

**é™¤BGDå¤–ï¼ŒSGDã€MBGDæ— æ³•ä¿è¯æ‰¾åˆ°å…¨å±€æœ€ä½ç‚¹ï¼Œæ›´å¯èƒ½é™·å…¥å…¨å±€æœ€ä½ç‚¹ã€‚**  

æ‰€ä»¥å¦‚ä»Šå·²ç»æœ‰å…¶ä»–çš„æ›´ä¼˜æ³•å¯ä¾›é€‰æ‹©ï¼š  

![1](https://user-images.githubusercontent.com/128795948/235175240-700e6644-2fe6-452d-b782-0d55aa1487e0.jpg)

---
5ï¸âƒ£å¯è§†åŒ–è®­ç»ƒè¿‡ç¨‹
---

ä½ å¯ä»¥ä½¿ç”¨tensorboardXè¿™ä¸ªç¬¬ä¸‰æ–¹åº“æ¥è®°å½•å’Œå±•ç¤ºè®­ç»ƒè¿‡ç¨‹ä¸­çš„å„ç§æŒ‡æ ‡ï¼Œå¦‚æŸå¤±ã€å‡†ç¡®ç‡ã€æ¢¯åº¦ç­‰ã€‚

>1.åˆ›å»ºä¸€ä¸ª SummaryWriter çš„ç¤ºä¾‹
     from tensorboardX import SummaryWriter

    # Creates writer1 object.
    # The log will be saved in 'runs/exp'
    writer1 = SummaryWriter('runs/exp')

    # Creates writer2 object with auto generated file name
    # The log directory will be something like 'runs/Aug20-17-20-33'
    writer2 = SummaryWriter()

    # Creates writer3 object with auto generated file name, the comment will be appended to the filename.
    # The log directory will be something like 'runs/Aug20-17-20-33-resnet'
    writer3 = SummaryWriter(comment='resnet')
    
>2.æ¥ä¸‹æ¥å°±å¯ä»¥è°ƒç”¨ SummaryWriter å®ä¾‹çš„å„ç§add_somethingæ–¹æ³•å‘æ—¥å¿—ä¸­å†™å…¥ä¸åŒç±»å‹çš„æ•°æ®äº†ï¼Œ  
>
>æƒ³è¦åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹å¯è§†åŒ–è¿™äº›æ•°æ®ï¼Œåªè¦åœ¨å‘½ä»¤è¡Œä¸­å¼€å¯ tensorboard å³å¯ã€‚

    tensorboard --logdir=<your_log_dir>
    
-add_scalar(tag, scalar_value, global_step=None, walltime=None)  

    tag (string): æ•°æ®åç§°ï¼Œä¸åŒåç§°çš„æ•°æ®ä½¿ç”¨ä¸åŒæ›²çº¿å±•ç¤º
    scalar_value (float): æ•°å­—å¸¸é‡å€¼
    global_step (int, optional): è®­ç»ƒçš„ step
    walltime (float, optional): è®°å½•å‘ç”Ÿçš„æ—¶é—´ï¼Œé»˜è®¤ä¸º time.time() 

***éœ€è¦æ³¨æ„ï¼Œè¿™é‡Œçš„scalar_valueä¸€å®šæ˜¯ float ç±»å‹ï¼Œå¦‚æœæ˜¯ PyTorch scalar tensorï¼Œåˆ™éœ€è¦è°ƒç”¨.item()æ–¹æ³•è·å–å…¶æ•°å€¼ã€‚***  
  
  
-add_histogram(tag, values, global_step=None, bins='tensorflow', walltime=None, max_bins=None)  

    tag (string): æ•°æ®åç§°
    values (torch.Tensor, numpy.array, or string/blobname): ç”¨æ¥æ„å»ºç›´æ–¹å›¾çš„æ•°æ®
    global_step (int, optional): è®­ç»ƒçš„ step
    bins (string, optional): å–å€¼æœ‰ â€˜tensorflowâ€™ã€â€˜autoâ€™ã€â€˜fdâ€™ ç­‰, è¯¥å‚æ•°å†³å®šäº†åˆ†æ¡¶çš„æ–¹å¼ï¼Œè¯¦è§è¿™é‡Œã€‚
    walltime (float, optional): è®°å½•å‘ç”Ÿçš„æ—¶é—´ï¼Œé»˜è®¤ä¸º time.time()
    max_bins (int, optional): æœ€å¤§åˆ†æ¡¶æ•°
    
-add_graph(model, input_to_model=None, verbose=False, **kwargs)  

    model (torch.nn.Module): å¾…å¯è§†åŒ–çš„ç½‘ç»œæ¨¡å‹
    input_to_model (torch.Tensor or list of torch.Tensor, optional): å¾…è¾“å…¥ç¥ç»ç½‘ç»œçš„å˜é‡æˆ–ä¸€ç»„å˜é‡

å®Œæˆå‡†å¤‡å·¥ä½œåï¼Œå°±å¯ä»¥å¼€å§‹è‡ªå·±çš„è®­ç»ƒå·¥ç¨‹äº†ã€‚
